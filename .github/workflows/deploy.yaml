name: Deploy AurashopBot

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: [self-hosted, kratombot]

    env:
      REPO_PATH: "/var/www/kratombot"

    steps:
      - name: âœ… Trust repo path
        run: |
          export HOME=/home/deploy
          git config --global --add safe.directory /var/www/kratombot

      - name: ðŸ”„ Pull latest code
        run: |
          cd $REPO_PATH
            git reset --hard
            git pull origin master

      - name: ðŸ“¦ Composer install
        env:
          HOME: /home/deploy
          COMPOSER_ALLOW_SUPERUSER: 1
        run: |
          cd $REPO_PATH
          composer install --no-dev --optimize-autoloader

      - name: ðŸ§± Laravel commands
        run: |
          cd $REPO_PATH
          php artisan migrate --force
          php artisan config:clear
          php artisan view:clear
          php artisan cache:clear
          php artisan route:clear
          php artisan optimize:clear
